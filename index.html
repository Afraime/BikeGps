<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BikeLive Tracker</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body {
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#f5f7fa,#c3cfe2);
}

/* ALERT BANNER */
#alertBanner{
  display:none;
  background:#ff0000;
  color:white;
  text-align:center;
  padding:15px;
  font-size:20px;
  font-weight:bold;
  animation:blink 1s infinite;
}
@keyframes blink{
  0%{opacity:1;}
  50%{opacity:0.5;}
  100%{opacity:1;}
}

/* HEADER */
header{
  background:linear-gradient(90deg,#1a2980,#26d0ce);
  color:white;
  padding:15px 30px;
  font-size:22px;
  font-weight:bold;
}

.container{
  padding:20px;
  max-width:1200px;
  margin:auto;
}

.dashboard{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}

@media(max-width:900px){
  .dashboard{grid-template-columns:1fr;}
}

.card{
  background:white;
  border-radius:12px;
  box-shadow:0 5px 20px rgba(0,0,0,0.1);
  padding:15px;
}

#map{height:400px;}

.stat{
  font-size:22px;
  font-weight:bold;
  color:#1a2980;
}

.label{
  color:#555;
  font-size:14px;
}

#status{
  margin-top:10px;
  padding:5px 10px;
  background:#26d0ce;
  color:white;
  display:inline-block;
  border-radius:20px;
  font-size:14px;
}
</style>
</head>

<body>

<div id="alertBanner">üö® UNAUTHORIZED MOVEMENT DETECTED!</div>
<audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

<header>üèçÔ∏è BikeLive GPS Tracker</header>

<div class="container">
<div class="dashboard">

<div class="card">
<h3>Live Map</h3>
<div id="map"></div>
<div id="status">Waiting for GPS...</div>
</div>

<div class="card">
<h3>Live Statistics</h3>
<p class="label">Speed</p>
<div class="stat" id="speed">0 km/h</div>

<p class="label">Distance Travelled</p>
<div class="stat" id="distance">0 km</div>

<p class="label">Tracking Time</p>
<div class="stat" id="time">0 min</div>

<p class="label">Last Update</p>
<div id="lastUpdate">Never</div>
</div>

</div>
</div>

<script>
// ---------------- FIREBASE CONFIG ----------------
var firebaseConfig = {
  apiKey: "AIzaSyDiSckMMD055k9cxend3oesbv2B2MBwOjI",
  databaseURL: "https://bikegps-1ae85-default-rtdb.asia-southeast1.firebasedatabase.app"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

// ---------------- MAP SETUP ----------------
var map = L.map('map').setView([23.81,90.41],13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'¬© OpenStreetMap'
}).addTo(map);

var bikeIcon = L.divIcon({
  html:'<i class="fas fa-motorcycle" style="font-size:28px;color:#1a2980;"></i>',
  iconSize:[30,30],
  iconAnchor:[15,15]
});

var marker = L.marker([23.81,90.41],{icon:bikeIcon}).addTo(map);

var lastPosition=null;
var totalDistance=0;
var startTime=Date.now();

// ---------------- FIREBASE LISTENER ----------------
db.ref("bikeTracker").on("value",function(snapshot){
  var d=snapshot.val();
  if(!d) return;

  var lat=d.latitude;
  var lng=d.longitude;
  var speed=d.speed||0;

  marker.setLatLng([lat,lng]);
  map.setView([lat,lng],13);

  document.getElementById("speed").innerHTML=speed.toFixed(1)+" km/h";

  // Distance calculation
  if(lastPosition){
    var dist=map.distance(lastPosition,[lat,lng])/1000;
    totalDistance+=dist;
    document.getElementById("distance").innerHTML=totalDistance.toFixed(2)+" km";
  }
  lastPosition=[lat,lng];

  // Time
  var minutes=Math.floor((Date.now()-startTime)/60000);
  document.getElementById("time").innerHTML=minutes+" min";

  document.getElementById("lastUpdate").innerHTML=new Date().toLocaleTimeString();

  // -------- MOVEMENT ALERT --------
  if(d.movementAlert===true){
    document.getElementById("alertBanner").style.display="block";
    document.getElementById("status").innerHTML="üö® Movement Detected!";
    document.getElementById("status").style.background="red";
    document.getElementById("alarmSound").play();
  }else{
    document.getElementById("alertBanner").style.display="none";
    document.getElementById("status").innerHTML="Live Tracking";
    document.getElementById("status").style.background="#26d0ce";
  }
});
</script>

</body>
</html>
